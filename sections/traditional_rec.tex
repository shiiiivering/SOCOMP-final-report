\begin{CJK*}{GBK}{hei}
\zihao{5}
\vskip 1mm
\section{传统推荐}
\end{CJK*}


在传统推荐系统问题中，有一个用户集合和一个物品集合。我们用 $\mathbf{U} = \} u_1, u_2, u_3, u_4, ..., u_n\}$ 和 $\mathbf{V} = \{v_1, v_2, v_3, v_4, ..., v_m \}$表示这些用户和物品。其中$\mathbf{U}$和$\mathbf{V}$的大小分别为n和m。用户会对一部分物品（通常只是物品集合的一个很小的子集）进行评分，于是我们可以构建一个矩阵 $\mathbf{R} \in  \mathbb{R}_{n \times m}$ 来表示用户对物品的评分矩阵：其中$\mathbf{R}_{ij}$为用户i对物品j的评分，如果用户没有对这个物品评分过，则将这个元素设置为$\varnothing$表示未知, 如图2所示。同时我们还用 $x_j$属于$R_l$ 来表示物品$v_j$的属性，$x_j$被用来评估物品的属性和用户的偏好。推荐系统的任务即为使用已知的评分数据来预测这些未知元素或者将用户没评分过的物品推荐给这个人。通常来说，这个用户-物品矩阵中仅有1\%的元素为已知\cite{2}。

\begin{figure}[htbp]
    \centerline{\includegraphics[width=3.15in]{../graphs/user-item-rating-example.png}}
    图1\quad 用户-物品 评分矩阵
    \label{fig2}
\end{figure}

近几十年来，越来越多的个性化推荐方法相继被提出来，它们可以被大致划分为以下三类：基于内容的推荐方法、基于协同过滤的推荐方法和混合推荐方法。我们将会在后面的小节中挑选有代表性的推荐系统对其逐一介绍。

{\begin{CJK*}{GBK}{hei}\subsection{基于内容的方法}\end{CJK*}}

基于内容的推荐方法源于信息检索(Information Retrival)和信息过滤(Information Filtering)。实际上这种推荐类似于一个对信息进行过滤的行为，这种过滤又有些类似于信息检索，只不过检索中的索引(query)被用户和物品的相对长期固定特征取代，我们面对的也不再是像员工信息这样结构化的数据，而是像杂志或者新闻这样的没有严格规定结构文本信息。这种推荐方法会给用户推荐与其过去选择的物品相似的新物品\cite{3}。大多数基于内容的推荐系统倾向于对具有充分的文本信息的物品，如新闻、书等进行推荐。直接使用原始的完整文本会使得数学计算时信息量骤增以至于无法用有效的内存去表示，因此这些推荐系统使用关键词来表示物品的内容和类型，同时它们又使用TF-IDF权重来描述每个关键词的重要性和信息量\cite{4}。其中TF(Term Frequency)为词频，TF越高表示一个关键词在文章中出现的频率越高。假设关键词$k_i$在第j个物品$v_j$中出现了$f_{i,j}$次。进一步地，我们计算得到关键词$k_i$在物品$v_j$中的标准化的词频$TF_{i,j}$：

$$TF_{i, j} = {{f_{i, j} } \over {\max _z f_{z, j} }},\eqno{\hbox{(2)}}$$

其中，$\max _z f_{z, j}$表示物品$v_j$中所有单词中出现最多次数的单词$k_z$的出现次数。

但是有些单词是很普遍使用的单词，它们会出现在很多物品中，如 "is", "good", "next" 等，这些单词对我们辨认两个物品之间的相关性或者区分两个物品的不同几乎没有任何作用，于是我们引入IDF(Inverse Document Frequency)即逆文件频率，来与TF结合使用。假设推荐系统一共有N个物品可供推荐，对于关键词$k_i$，它的IDF值计算方法如下：

$$IDF_i = \log {N \over {n_i }}.\eqno{\hbox{(3)}}$$

其中$n_i$表示表示关键词$k_i$出现过的文档的数量。于是我们可以得到关键词$k_i$对于物品$v_j$的TF-IDF权重：

$$x_{i, j} = TF_{i, j} \times IDF_i.\eqno{\hbox{(4)}}$$

我们用$x_{jk}$表示物品$v_j$的第k个关键词的TF-IDF权值，则物品$v_j$的内容我们就可以用$mathbf{x}_j = \{ x_{j1}, x_{j2}, x_{j3}, ..., x_{jl} \}$表示。于是我们可以使用这些关键词信息来描述用户$u_c$基于内容的信息 $ContentBasedProfile(c)$ 这个信息可以使用各个关键词对用户的影响程度来构建成向量 $(w_{c1}, w_{c2}, w_{c3}, ..., w_{ck})$。其中$w_{ij}$表示关键词$k_j$对用户$u_i$评分的影响强弱程度。$w_{ij}$有很多种计算方法，如以Rocchio 算法为代表的求平均值向量的方法等。在最后对物品做出评分或者决定是否推荐时，也有很多计算方式，如Winnow算法，贝叶斯分类器等。我们可以使用一个比较通用的公式来描述这个过程：

$$w(c, s) = score(ContentBasedProfile(c), Content(s)).\eqno{\hbox{(5)}}$$

其中w(c, s)表示用户$u_c$喜欢物品$v_s$的可能性大小。

使用这些数据，我们就能够使用用户曾经选择或者倾向的物品内容来向他们推荐相似的物品。我们将候选的物品和用户曾经评分的物品相比较，利用诸如余弦相似度等方式计算物品之间的相似度，来为这些候选物品打分。于是我们就可以预测用户对位置物品的评分，或者将预期评分较高的物品推荐给用户。除了传统的方法，我们还可以使用一些基于启发式的信息检索方法，同时也有一些其他的技术如各种分类和聚类算法的基于内容的推荐系统。

然而，基于内容的推荐系统存在一些限制\cite{5}：

1) 缺少对物品的内容的分析，正如上面所提到的，大多数基于内容的推荐系统都倾向于推荐存在文本信息的物品，因为这种物品容易被计算器自动分析和有效的提取特征，但是这就导致它们很难去对如音频、视频等多媒体数据中的内容或者说特征、关键词进行提取，进而也就难以对这些物品进行评分推荐。同时，由于缺乏对物品内容的分析，当物品的特征相同或相近时，我们就丧失了对它们的分辨力，比如如果有一篇写的很好的文章和一篇写的很差劲的文章，它们使用了相近的单词，我们就丧失了区分能力。

2) 过度特化：基于内容的推荐系统总是推荐与用户使用过或者评分过的物品相近的物品，这就导致了推荐的局限性，我们很难去发现用户的兴趣转移和发展。同时用户的使用体验也会很单调，时间长了就会感觉乏味。更进一步的，当用户使用了几乎完全相同的物品后，我们就不应该再持续向其推荐相同的物品，比如用户已经看过了某本小说，我们再持续向其推荐这本小说的其他印刷版本，这就是无效推荐。因此，我们可以发现，推荐的多样性也是推荐系统中很重要的性能指标，我们可以在推荐的过程中适当地加入一些随机性来提高推荐结果的多样性。

3) 新用户或冷启动问题：基于内容的推荐方法使用用户曾经评分过的物品进行推荐，因而推荐或评分的准确度和质量就和用户曾做出过的选择或评分的数量紧密相关，即严重依赖于用户的使用记录。但是当一个新的用户进入时，这个用户并没有评分记录或内容很少，基于内容的推荐系统就很难去做出有效的推荐。

{\begin{CJK*}{GBK}{hei}\subsection{基于协同过滤的方法}\end{CJK*}}

协同过滤是最流行的构建推荐系统的方法之一，它可以从用户曾经的行为中发现一些复杂甚至我们预料不到的特征，且不需要我们对数据的这些特征相应的领域有很多了解。基于协同过滤的推荐系统的一个根本的假设是：如果一些用户曾经做出了互相能够认可的选择，那他们在未来也更可能会做出与彼此更相似的选择。现有的基于协同过滤的推荐系统可以被大致分为两类：基于内存的方法和基于模型的方法。\cite{6}

\subsubsection{基于内存的协同过滤}

基于内存的协同过滤使用整个用户-物品矩阵或者对其取样来进行预测，它还可以进一步被细分为面向用户的方法和面向物品的方法\cite{6}。面向用户的方法从与用户相似的其他用户对相似物品的平均评分来预测一个未知的评分，面向物品的方法则是通过同一用户对其他相似物品的评分来预测。基于内存的协同过滤方法面对的主要问题就是计算相似性和计算评分。面向用户和面向物品两类方法对上面提到的两个问题的处理相似，因此我们取面向用户的方法作为例子来说明此类方法计算相似性和计算评分的过程。

\textbf{计算相似性}: 在面向用户的协同过滤中，计算用户之间的相似性是一个很重要的步骤。实际上有很多方法都可以解决这个问题，其中使用最广泛的如皮尔逊相关系数，余弦相似度等。

\textbf{皮尔逊相关系数}: 皮尔逊相关系数计算两个向量之间的线性相关的程度。我们使用向量来表示用户：第i个用户将被表示为$R_i$，则两个用户$u_i$和$u_j$之间的皮尔逊相关系数的计算公式如下：

$$S_{ij} = {{\sum\limits_{k \in S_{xy}} {(R_{ik} - \bar R_i) (R_{jk} - \bar R_j)}} \over {\sqrt{\sum\limits_{k \in I} {(R_{ik} - \bar R_i)^2} \sum\limits_{k \in I}{(R_{jk} - \bar R_j)^2}}}}.\eqno{\hbox{(6)}}$$

其中，I表示跟用户$u_i$，$u_j$都相关的物品集合，$S \in \mathbb R_{n \times n}$表示用户-用户的相似度矩阵，$\bar R_i$表示用户$u_i$过去的平均评分。

\textbf{余弦相似度}: 余弦相似度计算两个向量之间角度的余弦值，用户ui和uj之间的余弦相似度计算公式如下： 

$$S_ij = {
    {\sum\limits_{k \in I} {R_{ik} R_{jk}}} \over
    {
        \sqrt{
            \sum\limits_{k \in I} {R_{ik}^2}
            \sum\limits_{k \in I} {R_{jk}^2}
        }
    }
}.\eqno{\hbox{(7)}}$$

\textbf{评估最后得分}: 在得到用户-用户的相似度矩阵后，我们就可以集合相似用户的评分对此用户缺失的评分项进行预测。集合相似用户评分的方法有很多，其中使用最广泛的公式如下：

$$\tilde R_{ij} = \bar R_i + {
    {\sum\limits_{u_k \in N_i} {S_{ik} (R_{kj} - \bar R_k)}} \over 
    {\sum\limits_{u_k \in N_i} {S_{ik}}}
}.\eqno{\hbox{(8)}}$$

其中$N_i$是对物品$v_j$进行过评分的用户集合

\subsubsection{基于模型的协同过滤}

基于模型方法会先假设一个生成评分的模型，然后使用数据挖掘或者机器学习技术等方法来从训练集数据中寻找数据的特征，随后使用这些特征来对未知的评分进行预测。比起基于内存的协同过滤，基于模型的协同过滤旨在挖掘训练集中隐藏的更能够解释用户评分的因素。比较有名的基于模型的协同过滤方法有：贝叶斯置信网络协同过滤模型、聚类协同过滤模型、基于随机步进的方法、基于分解的协同过滤模型等。其中基于分解的协同过滤模型非常有竞争力，且被广泛用于构建推荐系统，即使它并不一定是效果最好的方法。
基于矩阵分解的协同过滤模型假设有有限的几个隐变量会影响用户的评分行为并且会执行用户-物品评分矩阵进行低秩分解。

我们分别用两个向量$u_i$属于$R_k$，$v_i$属于$R_k$来表示用户偏好和物品特征，其中K为隐变量的数量。基于矩阵分解的协同过滤模型将原问题转化为以下问题的求解：

$$\min\limits_{U,V}{
    \sum_{i = 1}^n {
        \sum_{j = 1}^m {
            W_{ij} (R_{ij} - {U_i V_j}^\top )^2 + \alpha {({\lVert {U} \rVert}_F^2 + {\lVert {V} \rVert}_F^2)}
        }
    }
}.\eqno{\hbox{(9)}} $$

其中 $\mathbf U = [U_1^\top, U_2^\top, ..., U_n^\top]$, $\mathbf V = [V_1^\top, V_2^\top, ..., V_m^\top]$，表示潜在因素数量的K通常通过交叉验证来决定。第二项$α(\lVert U \rVert_F^2 + \lVert V \rVert_F^2)$用于控制模型的复杂度来避免模型的过拟合，参数α用于平衡上述向量的贡献度。$W\in R_{n \times m}$是一个权重矩阵，$W_{ij}$为用户$u_i$对物品$v_j$打分的权重。一种通用的设置$W_ij$的方式即为当$R_{ij} \ne 0$时$W_{ij}=1$。此时上述公式(9)可变为如下形式\cite{8}： 

$$
J_{MF} = {
    \sum_{R_{ij} \ne 0} {(R_{ij} - U^{\top}V_j) ^ 2 + \alpha_r ({\lVert U \rVert}_F^2) + {\lVert V \rVert}_F^2}
}.\eqno{\hbox{(10)}}
$$

权重矩阵W还可以被用来处理训练过程中的隐式反馈\cite{9}和对边信息进行编码。常见的边信息如用户点击行为、用户和物品之间的度、用户权威性等\cite{7}。

基于协同过滤的推荐系统可以克服一些基于内容的推荐系统，比如协同过滤系统使用了评分信息，因此，协同过滤系统是不依赖数据的领域的，即它的模型应用并不需要研究者具有很深的相关领域知识，且可以推荐所有类型的物品。但是，基于协同过滤的推荐系统也有一些缺陷或者限制：比如它依旧无法解决冷启动的问题。同时，协同过滤系统计算过程中需要构建矩阵，数据的稀疏性是一个很严重的问题，如之前所说，一般来说用户-物品评分矩阵是很稀疏的，数据填充率可能不到1\%\cite{5}。

{\begin{CJK*}{GBK}{hei}\subsection{混合推荐系统}\end{CJK*}}

为了解决上述基于内容和基于协同过滤的推荐系统的限制，混合方法将基于内容和基于协同过滤的方法结合起来，已经有很多各种结合基于内容和协同过滤方法的策略被提出，它们大致也可被划分为三类\cite{5}: 结合不同推荐器的推荐系统、向协同过滤模型中天街基于内容推荐的特性的推荐系统和向基于内容的模型中添加基于协同过滤推荐特性的推荐系统。我们将会简单的举例介绍一下这三类系统。

\subsubsection{结合不同推荐器}

在这种策略下，基于内容和基于协同过滤的方法将被分别独立地实现，然后它们的预测结果将会被结合起来得到最终的推荐。这类结合两种推荐系统的方式已经有很多策略被提出，如：投票方案，评分的线性组合，等。

\subsubsection{向协同过滤模型中添加基于内容的特性}

使用这类策略的推荐系统利用基于内容的信息和非常规评分的物品来计算用户之间的相似度。\cite{10}这样的系统可以在某种程度上克服一些协同过滤的关于数据稀疏性的问题并且在物品相对于用户信息得分较高时直接向用户推荐。

\subsubsection{向基于内容的模型中添加基于协同过滤的特性}

使用这类策略最经典的一个实现就是在内容信息矩阵上使用降维技术。例如\cite{11}中就使用了潜在语义索引来构建一个协同过滤视角的用户信息，这些信息使得这种方法的表现比单纯使用基于内容的方法更好。
